#!/bin/bash
# FTP exploitation - targets Dionaea

DIONAEA="172.16.0.30"
LOGDIR="/home/kali/Desktop/fyp/attack_scripts/logs/exploitation"
USERS="/usr/share/seclists/Usernames/top-usernames-shortlist.txt"
PASS="/usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-1000.txt"

mkdir -p "$LOGDIR"

echo "FTP exploitation on $DIONAEA"

if nc -zw2 "$DIONAEA" 21 2>/dev/null; then
    echo "QUIT" | nc -w 3 "$DIONAEA" 21 > "$LOGDIR/ftp_banner_${DIONAEA}.txt"
    nmap -p 21 --script ftp-anon,ftp-syst "$DIONAEA" -oN "$LOGDIR/ftp_nmap_${DIONAEA}.txt"
    
    RCFILE="/tmp/msf_ftp_${DIONAEA}.rc"
    cat > "$RCFILE" << EOF
use auxiliary/scanner/ftp/ftp_version
set RHOSTS $DIONAEA
run
use auxiliary/scanner/ftp/anonymous
set RHOSTS $DIONAEA
run
exit
EOF
    timeout 120 msfconsole -q -r "$RCFILE" 2>/dev/null > "$LOGDIR/ftp_msf_${DIONAEA}.txt"
    rm -f "$RCFILE"
else
    echo "FTP not open"
fi

echo "Done"
